import pytest
import pandas as pd

from analytics.analytics import compute_RSI


def test_compute_RSI():
    df = pd.DataFrame({'Date': [x for x in range(0, 28)],
                       'Close': [184, 170, 215, 219, 191, 200, 134, 100, 107,
                                 163, 213, 208, 145, 153, 168, 161, 161, 155,
                                 111, 165, 153, 207, 201, 195, 191, 120, 206,
                                 181]})
    expected_df = pd.DataFrame({'Date': [x for x in range(0, 28)],
                                'Close': [184, 170, 215, 219, 191, 200, 134,
                                          100, 107, 163, 213, 208, 145, 153,
                                          168, 161, 161, 155, 111, 165, 153,
                                          207, 201, 195, 191, 120, 206, 181],
                                'deltas': [0, -14, 45, 4, -28, 9, -66, -34, 7,
                                           56, 50, -5, -63, 8, 15, -7, 0,
                                           -6, -44, 54, -12, 54, -6, -6, -4,
                                           -71,  8, -25],
                                'avg_gain': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                             0, 0, 0, 13.21, 13.21, 10.0, 9.71,
                                             13.57, 13.57, 17.43, 16.93, 12.93,
                                             9.36, 9.36, 15.5, 14.93],
                                'avg_loss': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                             0, 0, 0, 14.86, 13.86, 14.29,
                                             17.43, 16.07, 12.21, 9.79, 10.21,
                                             10.64, 10.93, 15.64, 11.14, 12.93],
                                'RS': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                       0, 0.89, 0.95, 0.7, 0.56, 0.84, 1.11,
                                       1.78, 1.66, 1.21, 0.86, 0.6, 1.39, 1.15],
                                'RSI': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                        0, 47.07, 48.81, 41.18, 35.79, 45.78,
                                        52.63, 64.04, 62.37, 54.85, 46.13,
                                        37.43, 58.18, 53.59]})
    actual_df = compute_RSI(df)

    assert actual_df == expected_df
